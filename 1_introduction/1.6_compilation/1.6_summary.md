<h1>Конспект лекций модуля 1.6 "Как компилируется программа на C++"</h1>

<h2>Этап №1: препроцессор</h2>

+ Язык препроцессора – это специальный язык программирования, встроенный в C++. 
+ Препроцессор работает с кодом на C++ как с текстом. 
+ Команды языка препроцессора называют директивами, все директивы начинаются со знака <span style="color: pink;">#</span>. 
+ Директива <span style="color: pink;">#include</span> позволяет подключать заголовочные
файлы к файлам кода.

1. <span style="color: pink;">#include <foo.h></span> — библиотечный заголовочный файл,
2. <span style="color: pink;">#include "bar.h" </span> — локальный заголовочный файл. 

+ Препроцессор заменяет директиву <span style="color: pink;">#include "bar.h" </span> на содержимое файла bar.h

<h2>Этап №2: компиляция</h2>

+ На вход компилятору поступает код на C++ после обработки препроцессором. 
+ Каждый файл с кодом компилируется отдельно и независимо от других файлов с кодом. 
+ Компилируется только файлы с кодом (т.е. *.cpp). 
+ Заголовочные файлы сами по себе ни во что не компилируются, только в составе файлов с кодом. 
+ На выходе компилятора из каждого файла с кодом получается “объектный файл” — бинарный файл со скомпилированным кодом (с расширением .o или .obj).

<h2>Этап №3: линковка (компоновка)</h2>

+ На этом этапе все объектные файлы объединяются в один исполняемый (или библиотечный) файл. 
+ При этом происходит подстановка адресов функций в места их вызова.

```c++
void foo ()
{
bar ();
}
```
```c++
void bar () { }
```

+ По каждому объектному файлу строится таблица всех функций, которые в нём определены.
+ На этапе компоновки важно, что каждая функция имеет уникальное имя.
+ В C++ может быть две функции с одним именем, но разными параметрами. 
+ Имена функций искажаются (mangle) таким образом, что в их имени кодируются их параметры. 

<h5>Например, компилятор GCC превратит имя функции foo в _Z3fooid.</h5>

```c++
void foo (int, double) { }
```

+ Аналогично функциям в линковке нуждаются глобальные переменные.

+ **_Точка входа_** — функция, вызываемая при запуске программы. По умолчанию — это функция main.

```c++
int main(){
    return 0;
}
```
или 
```c++
int main(int argc , char ** argv ){
    return 0;
}
```